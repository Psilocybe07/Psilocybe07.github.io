<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Customizable Spinning Wheel</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/p5.js/1.7.0/p5.min.js"></script>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 0;
            padding: 20px;
            display: flex;
            flex-direction: row;
            height: 100vh;
            box-sizing: border-box;
        }
        
        #canvas-container {
            flex: 2;
            display: flex;
            justify-content: center;
            align-items: center;
        }
        
        #controls {
            flex: 1;
            padding: 20px;
            background-color: #f5f5f5;
            display: flex;
            flex-direction: column;
            gap: 10px;
            max-width: 300px;
        }
        
        button {
            padding: 10px;
            background-color: #4CAF50;
            color: white;
            border: none;
            cursor: pointer;
            margin-bottom: 10px;
            border-radius: 4px;
        }
        
        button:hover {
            background-color: #45a049;
        }
        
        textarea {
            width: 100%;
            height: 200px;
            margin-bottom: 10px;
            padding: 8px;
            box-sizing: border-box;
            border: 1px solid #ccc;
            border-radius: 4px;
        }
        
        .help-text {
            font-size: 0.9em;
            color: #666;
            margin-bottom: 10px;
        }
    </style>
</head>
<body>
    <div id="canvas-container"></div>
    <div id="controls">
        <h2>Wheel Options</h2>
        
        <p class="help-text">Enter one item per line. These will appear on the wheel segments.</p>
        <textarea id="items-input">Option 1
Option 2
Option 3
Option 4
Option 5
Option 6</textarea>
        
        <button id="update-btn">Update Wheel</button>
        <button id="spin-btn">Spin the Wheel!</button>
        
        <div id="result-container">
            <h3>Result: <span id="result">-</span></h3>
        </div>
    </div>

    <script>
        let wheel;
        let segments = ["Option 1", "Option 2", "Option 3", "Option 4", "Option 5", "Option 6"];
        let angle = 0;
        let spinning = false;
        let targetAngle = 0;
        let spinSpeed = 0;
        let deceleration = 0.98;
        let minSpinSpeed = 0.2;
        let winner = "-";

        // Create the p5 instance
        const sketch = (p) => {
            p.setup = function() {
                const canvas = p.createCanvas(500, 500);
                canvas.parent('canvas-container');
                wheel = new Wheel(p.width/2, p.height/2, 200, segments);
                
                // Event listeners
                document.getElementById('update-btn').addEventListener('click', updateWheel);
                document.getElementById('spin-btn').addEventListener('click', startSpin);
            };

            p.draw = function() {
                p.background(240);
                
                // Draw the wheel
                wheel.display(angle);
                
                // Handle spinning animation
                if (spinning) {
                    angle += spinSpeed;
                    spinSpeed *= deceleration;
                    
                    if (spinSpeed < minSpinSpeed) {
                        spinning = false;
                        selectWinner();
                    }
                }
                
                // Draw the pointer
                p.push();
                p.translate(p.width/2, p.height/2);
                p.fill(255, 0, 0);
                p.triangle(220, 0, 240, -10, 240, 10);
                p.pop();
            };
            
            function selectWinner() {
                const segmentAngle = 2 * Math.PI / segments.length;
                const normalizedAngle = ((angle % (2 * Math.PI)) + (2 * Math.PI)) % (2 * Math.PI);
                const winnerIndex = Math.floor(segments.length - (normalizedAngle / segmentAngle) % segments.length);
                
                winner = segments[winnerIndex % segments.length];
                document.getElementById('result').textContent = winner;
            }
        };

        function updateWheel() {
            const textInput = document.getElementById('items-input').value;
            segments = textInput.split('\n').filter(item => item.trim() !== '');
            
            if (segments.length < 2) {
                alert('Please enter at least 2 options');
                return;
            }
            
            wheel.updateSegments(segments);
            document.getElementById('result').textContent = '-';
        }
        
        function startSpin() {
            if (!spinning) {
                spinning = true;
                spinSpeed = 0.3 + Math.random() * 0.2;
                document.getElementById('result').textContent = '-';
            }
        }
        
        class Wheel {
            constructor(x, y, radius, segments) {
                this.x = x;
                this.y = y;
                this.radius = radius;
                this.segments = segments;
                this.colors = [];
                this.generateColors();
            }
            
            generateColors() {
                this.colors = [];
                for (let i = 0; i < this.segments.length; i++) {
                    // Generate a color with good contrast
                    this.colors.push({
                        r: 100 + Math.floor(Math.random() * 155),
                        g: 100 + Math.floor(Math.random() * 155),
                        b: 100 + Math.floor(Math.random() * 155)
                    });
                }
            }
            
            updateSegments(newSegments) {
                this.segments = newSegments;
                this.generateColors();
            }
            
            display(rotationAngle) {
                const p = window._p5Instance;
                
                p.push();
                p.translate(this.x, this.y);
                p.rotate(rotationAngle);
                
                const segmentAngle = 2 * Math.PI / this.segments.length;
                
                // Draw wheel segments
                for (let i = 0; i < this.segments.length; i++) {
                    const startAngle = i * segmentAngle;
                    const endAngle = startAngle + segmentAngle;
                    
                    p.fill(this.colors[i].r, this.colors[i].g, this.colors[i].b);
                    p.stroke(0);
                    p.strokeWeight(2);
                    
                    p.beginShape();
                    p.vertex(0, 0);
                    for (let angle = startAngle; angle <= endAngle; angle += 0.01) {
                        p.vertex(this.radius * Math.cos(angle), this.radius * Math.sin(angle));
                    }
                    p.endShape(p.CLOSE);
                    
                    // Draw labels
                    p.push();
                    p.rotate(startAngle + segmentAngle / 2);
                    p.translate(this.radius * 0.7, 0);
                    p.rotate(Math.PI / 2);
                    p.fill(0);
                    p.noStroke();
                    p.textAlign(p.CENTER, p.MIDDLE);
                    p.textSize(14);
                    const displayText = this.segments[i].length > 12 
                        ? this.segments[i].substring(0, 10) + '..' 
                        : this.segments[i];
                    p.text(displayText, 0, 0);
                    p.pop();
                }
                
                // Draw center circle
                p.fill(255);
                p.stroke(0);
                p.strokeWeight(2);
                p.ellipse(0, 0, 20, 20);
                
                p.pop();
            }
        }
        
        // Initialize the p5 instance
        window._p5Instance = new p5(sketch);
    </script>
</body>
</html>
